<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</title>

  <style>
    :root{
      
      color-scheme: dark;--bg:#0b1220; --card:#0f1b2d; --text:#e7eefc; --muted:#a9b6d3;
      --line:rgba(255,255,255,.10); --input:rgba(255,255,255,.06); --input2:rgba(255,255,255,.09);
      --accent:#6eceeb; --star-off:#5b6b8b; --star-on:#ffd45a; --a11y-font-scale:1;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-size: calc(16px * var(--a11y-font-scale));
      font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Arial,sans-serif;
      background: var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position:fixed;
      inset:-16%;
      z-index:-1;
      pointer-events:none;
      background:
        radial-gradient(60% 42% at 72% 10%, rgba(110,206,235,.18) 0%, rgba(110,206,235,.10) 38%, rgba(110,206,235,0) 74%),
        radial-gradient(55% 45% at 18% 92%, rgba(85,188,217,.16) 0%, rgba(85,188,217,.08) 40%, rgba(85,188,217,0) 78%),
        radial-gradient(45% 35% at 110% 65%, rgba(255,212,90,.10) 0%, rgba(255,212,90,0) 72%),
        linear-gradient(180deg, rgba(255,255,255,.04) 0%, rgba(255,255,255,0) 36%);
      transform: translateZ(0);
    }
    .wrap{max-width:820px;margin:32px auto;padding:0 16px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:16px;
      padding:22px;
      box-shadow:0 18px 40px rgba(0,0,0,.30);
    }
    .header h1{margin:0 0 8px;font-size: calc(22px * var(--a11y-font-scale));line-height:1.35}
    .muted{color:var(--muted)}
    .header p{margin:0}
    .divider{height:1px;background:var(--line);margin:18px 0}
    .field{margin:14px 0}
    .label{display:block;margin-bottom:8px;font-weight:600}

    select, textarea{
      width:100%;
      border-radius:12px;
      border:1px solid var(--line);
      background:var(--input);
      color:var(--text);
      padding:12px 12px;
      outline:none;
      transition:border .15s ease, background .15s ease;
    }
    select:focus, textarea:focus{
      border-color:rgba(110,206,235,.45);
      background:var(--input2);
    }
    .hint{display:block;margin-top:8px;color:var(--muted);font-size:12px}

    .q{padding:14px 0;border-bottom:1px solid var(--line)}
    .q:last-of-type{border-bottom:0}
    .q-head{
      display:flex;gap:12px;align-items:baseline;justify-content:space-between;margin-bottom:10px
    }
    .q-head h3{margin:0;font-size: calc(15.5px * var(--a11y-font-scale));font-weight:650;line-height:1.5}
    .q-meta{color:var(--muted);font-size: calc(12px * var(--a11y-font-scale));white-space:nowrap}

    .rating{
      display:inline-flex;
      flex-direction:row-reverse;
      gap:8px;
      user-select:none;
    }
    .rating input{
      position:absolute;opacity:0;width:1px;height:1px;
    }
    .rating label{
      font-size: calc(34px * var(--a11y-font-scale));line-height:1;
      cursor:pointer;
      color:var(--star-off);
      filter:drop-shadow(0 8px 10px rgba(0,0,0,.25));
      transition:transform .08s ease, color .12s ease;
    }
    .rating label:hover{transform:translateY(-1px) scale(1.02)}
    .rating label:hover,
    .rating label:hover ~ label{color:var(--star-on)}
    .rating input:checked ~ label{color:var(--star-on)}
    .rating input:focus-visible + label{
      outline:2px solid rgba(110,206,235,.65);
      outline-offset:4px;
      border-radius:10px;
    }

    .actions{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap}
    .btn{
      border:1px solid var(--line);
      background:var(--input);
      color:var(--text);
      padding:11px 14px;
      border-radius:12px;
      cursor:pointer;
      transition:transform .06s ease, background .15s ease, border .15s ease;
    }
    .btn:hover{background:var(--input2)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      border-color:rgba(110,206,235,.35);
      background:linear-gradient(180deg, rgba(110,206,235,.18), rgba(110,206,235,.10));
    }
    .btn.primary:hover{border-color:rgba(110,206,235,.55)}
    .foot{margin:14px 0 0;font-size:12px}

    .hidden{display:none !important}
    .done-actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    .json{
      margin-top:14px;padding:14px;border-radius:12px;border:1px solid var(--line);
      background:rgba(0,0,0,.22);overflow:auto;max-height:320px;
      direction:ltr;text-align:left;font-size: calc(12px * var(--a11y-font-scale));
    }

    /* ===== A11Y TOOLBAR ===== */
    .a11y{
      position: fixed;
      left: 14px;
      top: 110px;
      z-index: 99999;
      display: grid;
      gap: 10px;
    }

    .a11y-btn{
      width: 52px;
      height: 52px;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor: pointer;
      display: grid;
      place-items: center;
      box-shadow: 0 12px 24px rgba(0,0,0,.28);
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .a11y-btn:hover{ background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.18); }
    .a11y-btn:active{ transform: translateY(1px); }
    .a11y-btn:active{ transform: translateY(1px); }

    .a11y-panel{
      position: absolute;
      left: 56px;
      top: 0;
      width: 320px;
      background: rgba(15,27,45,.78);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      padding: 10px 0;
      display: none;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }
    .a11y-panel.open{ display: block; }

    .a11y-title{
      font-weight: 800;
      padding: 12px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      color: var(--text);
    }

    .a11y-item{
      width: 100%;
      border: 0;
      background: transparent;
      color: var(--text);
      padding: 10px 14px;
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      text-align: right;
      font-size: 14px;
    }
    .a11y-item:hover{ background: rgba(255,255,255,.06); }
    .a11y-item:hover{ background: rgba(0,0,0,.06); }

    .a11y-right{
      opacity: .9;
      font-variant-numeric: tabular-nums;
    }

    .a11y-item.is-active{
      background: rgba(63,111,109,.12);
      outline: 1px dashed rgba(63,111,109,.55);
    }

    .a11y-reset{
      margin-top: 8px;
      border-top: 1px solid rgba(255,255,255,.10);
      padding-top: 14px;
    }

    /* ===== A11Y MODES ===== */
    body.a11y-light{
      color-scheme: light;
      --bg:#f3f6fb;
      --card:#ffffff;
      --text:#0b1220;
      --muted:#3b4a66;
      --line:rgba(0,0,0,.12);
      --input:rgba(0,0,0,.04);
      --input2:rgba(0,0,0,.07);
      --star-off:#7b8aa6;
    }
    body.a11y-light{
      background: var(--bg) !important;
    }

    body.a11y-light::before{
      /* Ù†ÙØ³ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„ÙƒÙ† Ø£Ù‡Ø¯Ù‰ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§ÙŠØª */
      background:
        radial-gradient(60% 42% at 72% 10%, rgba(110,206,235,.16) 0%, rgba(110,206,235,.08) 40%, rgba(110,206,235,0) 76%),
        radial-gradient(55% 45% at 18% 92%, rgba(85,188,217,.12) 0%, rgba(85,188,217,.06) 42%, rgba(85,188,217,0) 80%),
        linear-gradient(180deg, rgba(0,0,0,.04) 0%, rgba(0,0,0,0) 34%);
    }
    body.a11y-light .card{
      background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.78));
      box-shadow: 0 14px 32px rgba(0,0,0,.14);
    }
    body.a11y-light .hero-bar{
      background: rgba(0,0,0,.06);
      border: 1px solid rgba(0,0,0,.10);
    }
    body.a11y-light .a11y-btn{
      background: rgba(0,0,0,.06);
      border-color: rgba(0,0,0,.14);
      color: var(--text);
      box-shadow: 0 12px 22px rgba(0,0,0,.15);
    }
    body.a11y-light .a11y-panel{
      background: rgba(255,255,255,.86);
      border-color: rgba(0,0,0,.12);
      box-shadow: 0 18px 40px rgba(0,0,0,.18);
    }
    body.a11y-light .a11y-item:hover{ background: rgba(0,0,0,.05); }
    body.a11y-light .a11y-title{ border-bottom-color: rgba(0,0,0,.10); }
    body.a11y-light .a11y-reset{ border-top-color: rgba(0,0,0,.10); }

    body.a11y-contrast{
      --bg:#000;
      --text:#fff;
      --muted:#fff;
      --line:#fff;
      --input:#000;
      --input2:#111;
    }
    body.a11y-contrast{
      background: #000 !important;
    }

    body.a11y-underline a{ text-decoration: underline !important; }

    body.a11y-readable-font{
      font-family: Arial, Tahoma, "Segoe UI", sans-serif !important;
      letter-spacing: .2px;
      line-height: 1.75;
    }


    /* ===== VISUAL UPGRADE (patch) ===== */
    .card{
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 18px;
    }
    .header{
      position: relative;
      overflow: hidden;
    }
    .header::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(60% 22% at 85% 0%, rgba(110,206,235,.22) 0%, rgba(110,206,235,.10) 42%, rgba(110,206,235,0) 78%),
        radial-gradient(52% 26% at 10% 60%, rgba(255,212,90,.12) 0%, rgba(255,212,90,.06) 46%, rgba(255,212,90,0) 82%);
pointer-events:none;
      opacity:.9;
      filter: blur(0px);
    }
    .header > *{ position: relative; }

    .hero{
      margin-top:14px;
      padding:14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }
    .hero-top{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      font-size: calc(12.5px * var(--a11y-font-scale));
      color: var(--text);
      white-space:nowrap;
    }
    .pill.subtle{
      color: var(--muted);
      background: rgba(255,255,255,.03);
    }
    .hero-main{
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .hero-score-label{ font-size: calc(12px * var(--a11y-font-scale)); }
    .hero-score-value{
      font-weight:800;
      letter-spacing:.2px;
      font-size: calc(28px * var(--a11y-font-scale));
      line-height:1.1;
      margin-top:4px;
    }
    .hero-bar{
      flex: 1 1 320px;
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.09);
      overflow:hidden;
    }
    .hero-bar > span{
      display:block;
      height:100%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(110,206,235,.85), rgba(255,212,90,.75));
      box-shadow: 0 8px 18px rgba(110,206,235,.18);
      transition: width .25s ease;
      width:0%;
    }

    .q{
      position: relative;
      border-radius: 14px;
      padding: 14px 12px;
      margin: 12px 0;
      border: 1px solid transparent;
      background: rgba(255,255,255,.02);
    }
    .q:hover{ background: rgba(255,255,255,.03); }
    .q:focus-within{
      border-color: rgba(110,206,235,.32);
      box-shadow: 0 0 0 3px rgba(110,206,235,.10);
    }
    .q.is-answered{
      border-color: rgba(255,212,90,.22);
      background: linear-gradient(180deg, rgba(255,212,90,.06), rgba(255,255,255,.02));
    }

    @keyframes pop{
      0%{ transform: translateY(0) scale(1); }
      60%{ transform: translateY(-2px) scale(1.12); }
      100%{ transform: translateY(0) scale(1); }
    }
    .rating input:checked + label{ animation: pop .18s ease-out; }

    select{
      appearance:none;
      -webkit-appearance:none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24'%3E%3Cpath fill='%23a9b6d3' d='M7 10l5 5l5-5z'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position: 12px 50%;
      padding-left: 44px;
    }
    textarea{ resize: vertical; min-height: 120px; }


    /* ===== CUSTOM SELECT (A11Y-friendly) ===== */
    .sr-only{
      position:absolute !important;
      width:1px !important;
      height:1px !important;
      padding:0 !important;
      margin:-1px !important;
      overflow:hidden !important;
      clip:rect(0,0,0,0) !important;
      white-space:nowrap !important;
      border:0 !important;
    }

    .selectbox{ position:relative; }
    .selectbtn{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:var(--input);
      color:var(--text);
      padding:12px 12px;
      cursor:pointer;
      transition:border .15s ease, background .15s ease, transform .06s ease;
    }
    .selectbtn:hover{ background:var(--input2); }
    .selectbtn:active{ transform: translateY(1px); }
    .selectbtn:focus-visible{
      outline:2px solid rgba(110,206,235,.65);
      outline-offset:3px;
    }
    .selecttext{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .selectchev{ opacity:.85; font-size:14px; }
    .selectmenu{
      position:absolute;
      left:0; right:0;
      top:calc(100% + 8px);
      z-index:60;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(15,27,45,.92);
      box-shadow:0 18px 40px rgba(0,0,0,.35);
      padding:8px;
      display:none;
      max-height:260px;
      overflow:auto;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    body.a11y-light .selectmenu{
      background: rgba(255,255,255,.92);
      box-shadow:0 18px 40px rgba(0,0,0,.18);
    }
    .selectmenu.open{ display:block; }
    .selectopt{
      padding:10px 12px;
      border-radius:10px;
      cursor:pointer;
      color:var(--text);
    }
    .selectopt:hover{ background: rgba(255,255,255,.06); }
    body.a11y-light .selectopt:hover{ background: rgba(0,0,0,.06); }
    .selectopt.is-active{
      background: rgba(110,206,235,.10);
      outline: 1px dashed rgba(110,206,235,.35);
    }
    .selectopt[aria-selected="true"]{
      background: rgba(255,212,90,.10);
      outline: 1px solid rgba(255,212,90,.20);
    }
    .selecterr{
      display:block;
      margin-top:8px;
      color: rgba(255,160,160,.95);
      font-size:12px;
    }
    .selectbox.has-error .selectbtn{
      border-color: rgba(255,120,120,.45);
      box-shadow: 0 0 0 3px rgba(255,120,120,.12);
    }

    .notes-meta{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-top:6px;
    }

    .summary{
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .sum-row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:flex-start;
    }
    .sum-k{
      color: var(--muted);
      font-size: calc(12px * var(--a11y-font-scale));
      margin-bottom: 6px;
    }
    .sum-v{
      font-weight: 750;
      font-size: calc(15px * var(--a11y-font-scale));
    }
    .sum-notes{ margin-top: 10px; }
    .sum-notes .sum-v{ font-weight: 550; color: var(--text); }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      z-index: 999999;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(15,27,45,.92);
      color: var(--text);
      box-shadow: 0 18px 40px rgba(0,0,0,.32);
      max-width: min(560px, calc(100vw - 24px));
      text-align: center;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .toast.ok{ border-color: rgba(110,206,235,.35); }
    .toast.bad{ border-color: rgba(255,120,120,.35); }

    /* A11Y panel visual alignment with theme (no logic change) */
    .a11y-btn{
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(110,206,235,.22), rgba(110,206,235,.10));
      border: 1px solid rgba(110,206,235,.35);
      color: var(--text);
    }
    .a11y-panel{
      background: rgba(15,27,45,.95);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 16px;
      overflow: hidden;
    }
    .a11y-title{ color: var(--text); }
    .a11y-item:hover{ background: rgba(255,255,255,.06); }
    .a11y-item.is-active{
      background: rgba(110,206,235,.10);
      outline: 1px dashed rgba(110,206,235,.35);
    }
    .a11y-reset{ border-top: 1px solid rgba(255,255,255,.10); }

  
    @media (forced-colors: active){
      body::before{ display:none !important; }
      .card, .a11y-panel{
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
      .selectbtn, .selectmenu{
        background: Canvas !important;
        color: CanvasText !important;
        border-color: GrayText !important;
        box-shadow: none !important;
      }
      .selectopt:hover{ background: transparent !important; }
      .selectopt.is-active{
        background: transparent !important;
        outline: 1px dashed GrayText !important;
      }
      .selectopt[aria-selected="true"]{
        background: transparent !important;
        outline: 1px solid GrayText !important;
      }

    }

      /* Ø®Ù„Ù‘Ù‡Ø§ ØªØªØ¨Ø¹ Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ø´Ø§Ù† Ù…Ø§ ÙŠØµÙŠØ± Ø®Ù„Ø· ØºØ±ÙŠØ¨ */
      body{ background: Canvas !important; color: CanvasText !important; }
      .card{
        background: Canvas !important;
        border-color: GrayText !important;
        box-shadow: none !important;
      }
      select, textarea, .btn{
        background: Canvas !important;
        color: CanvasText !important;
        border-color: GrayText !important;
      }
      .btn.primary{
        background: Highlight !important;
        color: HighlightText !important;
        border-color: Highlight !important;
      }
      .a11y-btn, .a11y-panel{
        background: Canvas !important;
        color: CanvasText !important;
        border-color: GrayText !important;
        box-shadow: none !important;
      }
      .a11y-item:hover{ background: transparent !important; }
    }

  </style>
</head>

<body>

  <!-- A11Y TOOLBAR -->
  <div class="a11y" id="a11y">
    <button class="a11y-btn" id="a11yBtn" type="button" aria-label="Ø£Ø¯Ø§Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©" aria-expanded="false">
      <svg width="26" height="26" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor" d="M12 2a2 2 0 1 1 0 4a2 2 0 0 1 0-4ZM5 7a1 1 0 0 0 0 2h4v12a1 1 0 1 0 2 0v-6h2v6a1 1 0 1 0 2 0V9h4a1 1 0 1 0 0-2H5Z"/>
      </svg>
    </button>

    <div class="a11y-panel" id="a11yPanel" role="menu" aria-hidden="true">
      <div class="a11y-title">Ø£Ø¯Ø§Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©</div>

      <button class="a11y-item" type="button" data-action="text_inc">
        <span>Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Øµ</span>
        <span class="a11y-right" id="a11yScaleLabel">100%</span>
      </button>

      <button class="a11y-item" type="button" data-action="text_dec">
        <span>ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ</span>
        <span class="a11y-right">Aâˆ’</span>
      </button>

      <button class="a11y-item" type="button" data-toggle="grayscale">
        <span>ØªØ¯Ø±Ù‘Ø¬ Ø±Ù…Ø§Ø¯ÙŠ</span>
        <span class="a11y-right">â–¦</span>
      </button>

      <button class="a11y-item" type="button" data-toggle="highContrast">
        <span>ØªØ¨Ø§ÙŠÙ† Ø¹Ø§Ù„ÙŠ</span>
        <span class="a11y-right">â—</span>
      </button>

      <button class="a11y-item" type="button" data-toggle="negativeContrast">
        <span>ØªØ¨Ø§ÙŠÙ† Ø³Ù„Ø¨ÙŠ</span>
        <span class="a11y-right">â—‘</span>
      </button>

      <button class="a11y-item" type="button" data-toggle="lightBg">
        <span>Ø¶ÙˆØ¡ Ø§Ù„Ø®Ù„ÙÙŠØ©</span>
        <span class="a11y-right">ğŸ’¡</span>
      </button>

      <button class="a11y-item" type="button" data-toggle="underlineLinks">
        <span>ØªØ³Ø·ÙŠØ± Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</span>
        <span class="a11y-right">ğŸ”—</span>
      </button>

      <button class="a11y-item" type="button" data-toggle="readableFont">
        <span>Ø§Ù„Ø®Ø· Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡</span>
        <span class="a11y-right">A</span>
      </button>

      <button class="a11y-item a11y-reset" type="button" data-action="reset">
        <span>Reset</span>
        <span class="a11y-right">â†º</span>
      </button>
    </div>
  </div>

  <main class="wrap">
    <section class="card" id="formCard">
      <header class="header">
        <h1>Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø±Ø¶Ø§ Ø¹Ø§Ù… Ø¹Ù† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ù…Ø¹ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</h1>
        <p class="muted">Ù‚ÙŠÙ‘Ù… Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø¨Ø§Ù„Ù†Ø¬ÙˆÙ…ØŒ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©.</p>

        <div class="hero" aria-label="Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…">
          <div class="hero-top">
            <span class="pill" id="servicePill">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©: â€”</span>
            <span class="pill subtle" id="progressHint">Ø§Ø®ØªØ± Ø§Ù„Ù†Ø¬ÙˆÙ… Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
          </div>
          <div class="hero-main">
            <div class="hero-score" aria-hidden="true">
              <div class="hero-score-label muted">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
              <div class="hero-score-value" id="avgLabel">â€”</div>
            </div>
            <div class="hero-bar" aria-hidden="true"><span id="avgBar" style="width:0%"></span></div>
          </div>
        </div>
      </header>

      <form id="surveyForm" novalidate>
        <div class="field">
          <label for="serviceTypeBtn" class="label">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>

          <div class="selectbox" id="serviceTypeBox">
            <button type="button" class="selectbtn" id="serviceTypeBtn" aria-haspopup="listbox" aria-expanded="false">
              <span class="selecttext" id="serviceTypeText">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</span>
              <span class="selectchev" aria-hidden="true">â–¾</span>
            </button>

            <div class="selectmenu" id="serviceTypeMenu" role="listbox" tabindex="-1" aria-labelledby="serviceTypeBtn">
              <div class="selectopt" role="option" data-value="ØªØ£Ù‡ÙŠÙ„" aria-selected="false">ØªØ£Ù‡ÙŠÙ„</div>
              <div class="selectopt" role="option" data-value="ØªÙˆØ¸ÙŠÙ" aria-selected="false">ØªÙˆØ¸ÙŠÙ</div>
              <div class="selectopt" role="option" data-value="Ù…ØªØ§Ø¨Ø¹Ø©" aria-selected="false">Ù…ØªØ§Ø¨Ø¹Ø©</div>
              <div class="selectopt" role="option" data-value="Ø§Ø³ØªØ´Ø§Ø±Ø©" aria-selected="false">Ø§Ø³ØªØ´Ø§Ø±Ø©</div>
            </div>

            <!-- input required for FormData + HTML validity -->
            <input class="sr-only" id="serviceType" name="service_type" type="text" value="" required readonly tabindex="-1" aria-hidden="true">
            <small class="selecterr" id="serviceTypeErr"></small>
          </div>

          <small class="hint">Ø§Ø®ØªÙŠØ§Ø± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·.</small>
        </div>

        <div class="divider"></div>

        <div class="q">
          <div class="q-head">
            <h3>ÙƒØ§Ù†Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…ÙÙ‡ÙˆÙ…Ø© Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„ÙŠ.</h3>
            <span class="q-meta" data-live-for="q1">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
          </div>
          <div class="rating" aria-label="ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„">
            <input type="radio" id="q1-5" name="q1" value="5" required><label for="q1-5" title="5 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q1-4" name="q1" value="4"><label for="q1-4" title="4 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q1-3" name="q1" value="3"><label for="q1-3" title="3 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q1-2" name="q1" value="2"><label for="q1-2" title="Ù†Ø¬Ù…ØªÙŠÙ†">â˜…</label>
            <input type="radio" id="q1-1" name="q1" value="1"><label for="q1-1" title="Ù†Ø¬Ù…Ø©">â˜…</label>
          </div>
        </div>

        <div class="q">
          <div class="q-head">
            <h3>ÙƒØ§Ù†Øª Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø³Ù‡Ù„Ø© ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ø¶Ø­.</h3>
            <span class="q-meta" data-live-for="q2">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
          </div>
          <div class="rating" aria-label="ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ">
            <input type="radio" id="q2-5" name="q2" value="5" required><label for="q2-5" title="5 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q2-4" name="q2" value="4"><label for="q2-4" title="4 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q2-3" name="q2" value="3"><label for="q2-3" title="3 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q2-2" name="q2" value="2"><label for="q2-2" title="Ù†Ø¬Ù…ØªÙŠÙ†">â˜…</label>
            <input type="radio" id="q2-1" name="q2" value="1"><label for="q2-1" title="Ù†Ø¬Ù…Ø©">â˜…</label>
          </div>
        </div>

        <div class="q">
          <div class="q-head">
            <h3>ØªØ¹Ø§Ù…Ù„ Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ† Ù…Ø¹ÙŠ Ø¨Ø§Ø­ØªØ±Ø§Ù… ÙˆØªØ¹Ø§ÙˆÙ†.</h3>
            <span class="q-meta" data-live-for="q3">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
          </div>
          <div class="rating" aria-label="ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù„Ø«">
            <input type="radio" id="q3-5" name="q3" value="5" required><label for="q3-5" title="5 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q3-4" name="q3" value="4"><label for="q3-4" title="4 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q3-3" name="q3" value="3"><label for="q3-3" title="3 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q3-2" name="q3" value="2"><label for="q3-2" title="Ù†Ø¬Ù…ØªÙŠÙ†">â˜…</label>
            <input type="radio" id="q3-1" name="q3" value="1"><label for="q3-1" title="Ù†Ø¬Ù…Ø©">â˜…</label>
          </div>
        </div>

        <div class="q">
          <div class="q-head">
            <h3>Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø­Ù‚Ù‚Øª Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù„ÙŠ.</h3>
            <span class="q-meta" data-live-for="q4">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
          </div>
          <div class="rating" aria-label="ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø¹">
            <input type="radio" id="q4-5" name="q4" value="5" required><label for="q4-5" title="5 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q4-4" name="q4" value="4"><label for="q4-4" title="4 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q4-3" name="q4" value="3"><label for="q4-3" title="3 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q4-2" name="q4" value="2"><label for="q4-2" title="Ù†Ø¬Ù…ØªÙŠÙ†">â˜…</label>
            <input type="radio" id="q4-1" name="q4" value="1"><label for="q4-1" title="Ù†Ø¬Ù…Ø©">â˜…</label>
          </div>
        </div>

        <div class="q">
          <div class="q-head">
            <h3>Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù…ØŒ Ø£Ù†Ø§ Ø±Ø§Ø¶Ù Ø¹Ù† ØªØ¬Ø±Ø¨ØªÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©.</h3>
            <span class="q-meta" data-live-for="q5">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>
          </div>
          <div class="rating" aria-label="ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø®Ø§Ù…Ø³">
            <input type="radio" id="q5-5" name="q5" value="5" required><label for="q5-5" title="5 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q5-4" name="q5" value="4"><label for="q5-4" title="4 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q5-3" name="q5" value="3"><label for="q5-3" title="3 Ù†Ø¬ÙˆÙ…">â˜…</label>
            <input type="radio" id="q5-2" name="q5" value="2"><label for="q5-2" title="Ù†Ø¬Ù…ØªÙŠÙ†">â˜…</label>
            <input type="radio" id="q5-1" name="q5" value="1"><label for="q5-1" title="Ù†Ø¬Ù…Ø©">â˜…</label>
          </div>
        </div>

        <div class="divider"></div>

        <div class="field">
          <label for="notes" class="label">Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒÙ… ÙˆÙ…Ù‚ØªØ±Ø­Ø§ØªÙƒÙ… Ù„Ù„ØªØ­Ø³ÙŠÙ†</label>
          <textarea id="notes" name="notes" rows="5" maxlength="400" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
          <div class="notes-meta">
            <small class="hint">Ø§Ø®ØªÙŠØ§Ø±ÙŠ.</small>
            <small class="hint" id="notesCount">0/400</small>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn primary" id="submitBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†</button>
          <button type="reset" class="btn" id="resetBtn">Ù…Ø³Ø­</button>
        </div>

        <p class="foot muted">Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø£Ù†Øª ØªØ³Ø§Ø¹Ø¯Ù†Ø§ Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø©. Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ.</p>
      </form>
    </section>

    <section class="card hidden" id="doneCard" aria-live="polite">
      <h2>ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… âœ…</h2>
      <p class="muted">Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ. ØªÙ… Ø­ÙØ¸ Ø±Ø¯Ùƒ.</p>

      <div class="summary" id="doneSummary"></div>

      <div class="done-actions">
        <button class="btn primary" id="newOneBtn">Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø¬Ø¯ÙŠØ¯</button>
        <button class="btn" id="copyBtn" title="Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ€ JSON">Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      </div>

      <pre class="json" id="jsonOut"></pre>
    </section>
  </main>

  <div class="toast hidden" id="toast" role="status" aria-live="polite"></div>

  <script>
    (() => {
      const form = document.getElementById("surveyForm");
      const formCard = document.getElementById("formCard");
      const doneCard = document.getElementById("doneCard");
      const jsonOut = document.getElementById("jsonOut");
      const submitBtn = document.getElementById("submitBtn");
      const newOneBtn = document.getElementById("newOneBtn");
      const copyBtn = document.getElementById("copyBtn");

      const avgLabel = document.getElementById("avgLabel");
      const avgBar = document.getElementById("avgBar");
      const progressHint = document.getElementById("progressHint");
      const servicePill = document.getElementById("servicePill");
      const notesEl = document.getElementById("notes");
      const notesCount = document.getElementById("notesCount");
      const doneSummary = document.getElementById("doneSummary");
      const toastEl = document.getElementById("toast");


      // ===== Custom Select (service type) to follow A11Y modes (no native OS dropdown) =====
      const serviceHidden = document.getElementById("serviceType");
      const serviceBox = document.getElementById("serviceTypeBox");
      const serviceBtn = document.getElementById("serviceTypeBtn");
      const serviceText = document.getElementById("serviceTypeText");
      const serviceMenu = document.getElementById("serviceTypeMenu");
      const serviceErr = document.getElementById("serviceTypeErr");
      const serviceOpts = serviceMenu ? Array.from(serviceMenu.querySelectorAll(".selectopt")) : [];

      function validateService() {
        if (!serviceHidden || !serviceBox) return true;
        const ok = !!(serviceHidden.value || "").trim();
        serviceBox.classList.toggle("has-error", !ok);
        if (serviceErr) serviceErr.textContent = ok ? "" : "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©.";
        return ok;
      }

      function syncServiceUI() {
        if (!serviceHidden || !serviceText) return;
        const v = (serviceHidden.value || "").trim();
        serviceText.textContent = v || "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©";
        serviceOpts.forEach((opt) => {
          const selected = (opt.getAttribute("data-value") || "") === v;
          opt.setAttribute("aria-selected", selected ? "true" : "false");
          opt.classList.toggle("is-active", selected);
        });
        validateService();
      }

      function openServiceMenu(open) {
        if (!serviceMenu || !serviceBtn) return;
        const isOpen = open ?? !serviceMenu.classList.contains("open");
        serviceMenu.classList.toggle("open", isOpen);
        serviceBtn.setAttribute("aria-expanded", String(isOpen));
        if (isOpen) {
          // highlight current, otherwise first
          const current = serviceOpts.findIndex(o => o.getAttribute("aria-selected") === "true");
          const idx = current >= 0 ? current : 0;
          setActiveServiceOpt(idx);
        }
      }

      function closeServiceMenu() { openServiceMenu(false); }

      function setActiveServiceOpt(index) {
        if (!serviceMenu || !serviceOpts.length) return;
        const i = Math.max(0, Math.min(serviceOpts.length - 1, index));
        serviceOpts.forEach((o, n) => o.classList.toggle("is-active", n === i));
        const active = serviceOpts[i];
        // ensure visible
        const r = active.getBoundingClientRect();
        const mr = serviceMenu.getBoundingClientRect();
        if (r.top < mr.top) serviceMenu.scrollTop -= (mr.top - r.top) + 8;
        if (r.bottom > mr.bottom) serviceMenu.scrollTop += (r.bottom - mr.bottom) + 8;
        serviceMenu.dataset.activeIndex = String(i);
      }

      function chooseService(value) {
        if (!serviceHidden) return;
        serviceHidden.value = value;
        serviceHidden.dispatchEvent(new Event("change", { bubbles: true }));
        syncServiceUI();
        closeServiceMenu();
      }

      if (serviceBtn && serviceMenu && serviceHidden) {
        // initial
        syncServiceUI();

        serviceBtn.addEventListener("click", () => openServiceMenu());

        serviceOpts.forEach((opt) => {
          opt.addEventListener("click", () => chooseService(opt.getAttribute("data-value") || ""));
        });

        // close when clicking outside
        document.addEventListener("click", (e) => {
          if (!serviceMenu.classList.contains("open")) return;
          if (serviceBox && !serviceBox.contains(e.target)) closeServiceMenu();
        });

        // keyboard support
        serviceBtn.addEventListener("keydown", (e) => {
          if (e.key === "ArrowDown" || e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openServiceMenu(true);
            serviceMenu.focus();
          }
        });

        serviceMenu.addEventListener("keydown", (e) => {
          const active = Number(serviceMenu.dataset.activeIndex || "0");
          if (e.key === "Escape") { e.preventDefault(); closeServiceMenu(); serviceBtn.focus(); return; }
          if (e.key === "ArrowDown") { e.preventDefault(); setActiveServiceOpt(active + 1); return; }
          if (e.key === "ArrowUp") { e.preventDefault(); setActiveServiceOpt(active - 1); return; }
          if (e.key === "Home") { e.preventDefault(); setActiveServiceOpt(0); return; }
          if (e.key === "End") { e.preventDefault(); setActiveServiceOpt(serviceOpts.length - 1); return; }
          if (e.key === "Enter") {
            e.preventDefault();
            const idx = Number(serviceMenu.dataset.activeIndex || "0");
            const opt = serviceOpts[idx];
            if (opt) chooseService(opt.getAttribute("data-value") || "");
            return;
          }
        });

        // if something changes it programmatically (reset/new form)
        serviceHidden.addEventListener("change", () => {
          syncServiceUI();
          setServicePill();
        });
      }


      let lastPayload = null;

      // Google Sheet (Apps Script Web App)
      // Ø¶Ø¹ Ø±Ø§Ø¨Ø· /exec + ØªÙˆÙƒÙ† Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø³ÙƒØ±Ø¨Øª. Ø§ØªØ±ÙƒÙ‡Ù… ÙØ§Ø¶ÙŠÙŠÙ† Ù„Ùˆ Ù…Ø§ ØªØ¨ÙŠ ØªØ³Ø¬ÙŠÙ„.
      const SHEETS_WEBAPP_URL = ""; // Ù…Ø«Ø§Ù„: https://script.google.com/macros/s/XXXX/exec
      const SHEETS_TOKEN = "";

      const MAX_NOTES = 400;

      function escapeHtml(s) {
        return String(s).replace(/[&<>"']/g, (m) => ({
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#39;"
        }[m]));
      }

      function toast(msg, ok = true) {
        if (!toastEl) return;
        toastEl.textContent = msg;
        toastEl.classList.remove("hidden", "ok", "bad");
        toastEl.classList.add(ok ? "ok" : "bad");
        clearTimeout(toastEl._t);
        toastEl._t = setTimeout(() => toastEl.classList.add("hidden"), 2200);
      }

      function setServicePill() {
        if (!servicePill) return;
        const v = document.getElementById("serviceType")?.value;
        servicePill.textContent = v ? `Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©: ${v}` : "Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©: â€”";
      }

      function updateAverage() {
        if (!avgLabel || !avgBar || !progressHint) return;

        const keys = ["q1", "q2", "q3", "q4", "q5"];
        let sum = 0, count = 0;

        keys.forEach((k) => {
          const sel = document.querySelector(`input[name="${k}"]:checked`);
          if (sel) {
            count++;
            sum += Number(sel.value) || 0;
            const q = sel.closest(".q");
            if (q) q.classList.add("is-answered");
          }
        });

        // remove "answered" from empty questions
        document.querySelectorAll(".q").forEach((q) => {
          const name = q.querySelector('input[type="radio"]')?.name;
          if (name && !document.querySelector(`input[name="${name}"]:checked`)) q.classList.remove("is-answered");
        });

        if (count === 0) {
          avgLabel.textContent = "â€”";
          avgBar.style.width = "0%";
          progressHint.textContent = "Ø§Ø®ØªØ± Ø§Ù„Ù†Ø¬ÙˆÙ… Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…";
          return;
        }

        const avg = sum / count;
        avgLabel.textContent = `${avg.toFixed(1)}/5`;
        avgBar.style.width = `${(avg / 5) * 100}%`;
        progressHint.textContent = (count === 5) ? "Ù…ÙƒØªÙ…Ù„ âœ…" : `Ù…ÙƒØªÙ…Ù„: ${count}/5`;
      }

      function wireNotesCounter() {
        if (!notesEl || !notesCount) return;
        const render = () => {
          const n = (notesEl.value || "").length;
          notesCount.textContent = `${n}/${MAX_NOTES}`;
        };
        notesEl.addEventListener("input", render);
        render();
      }


      function wireLiveMeta() {
        const groups = ["q1", "q2", "q3", "q4", "q5"];
        groups.forEach((name) => {
          const meta = document.querySelector(`[data-live-for="${name}"]`);
          const inputs = document.querySelectorAll(`input[name="${name}"]`);
          inputs.forEach((inp) => {
            inp.addEventListener("change", () => {
              meta.textContent = `ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${inp.value}/5`;
              updateAverage();
            });
          });
        });
      }

      function buildPayload() {
        const fd = new FormData(form);
        const data = Object.fromEntries(fd.entries());
        ["q1","q2","q3","q4","q5"].forEach(k => data[k] = Number(data[k]));
        return { ...data, submitted_at: new Date().toISOString() };
      }

      async function sendPayload(payload) {
        // 1) Google Sheet Ø¹Ø¨Ø± Apps Script Web App
        if (SHEETS_WEBAPP_URL && SHEETS_TOKEN) {
          const body = new URLSearchParams({
            token: SHEETS_TOKEN,
            service_type: payload.service_type || "",
            q1: String(payload.q1 ?? ""),
            q2: String(payload.q2 ?? ""),
            q3: String(payload.q3 ?? ""),
            q4: String(payload.q4 ?? ""),
            q5: String(payload.q5 ?? ""),
            notes: payload.notes || "",
            submitted_at: payload.submitted_at || ""
          });

          try {
            await fetch(SHEETS_WEBAPP_URL, {
              method: "POST",
              body,
              mode: "no-cors"
            });
            return true; // no-cors Ù…Ø§ ÙŠØ±Ø¬Ù‘Ø¹ Ù†ØªÙŠØ¬Ø©ØŒ Ø§Ù„Ù…Ù‡Ù… Ø£Ù†Ù‡ Ø§Ù†Ø±Ø³Ù„
          } catch {
            return false;
          }
        }

        // 2) FiveM NUI (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø£Ùˆ endpoint Ù…Ø­Ù„ÙŠ
        const isNui = typeof window.GetParentResourceName === "function";
        const url = isNui ? `https://${window.GetParentResourceName()}/submitSurvey` : `/submitSurvey`;

        try {
          const res = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json; charset=UTF-8" },
            body: JSON.stringify(payload)
          });
          return res.ok;
        } catch {
          // ØªØ´ØºÙŠÙ„ Ù…Ø­Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ±
          return false;
        }
      }

      function showDone(payload, sentOk) {
        lastPayload = payload;

        // Ù…Ù„Ø®Øµ Ù„Ø·ÙŠÙ Ø¨Ø¯Ù„ Ù…Ø§ ÙŠÙƒÙˆÙ† ÙƒÙ„ Ø´ÙŠØ¡ JSON ÙÙ‚Ø·
        if (doneSummary) {
          const avg = (Number(payload.q1) + Number(payload.q2) + Number(payload.q3) + Number(payload.q4) + Number(payload.q5)) / 5;
          const notesSafe = payload.notes ? escapeHtml(payload.notes) : "";
          doneSummary.innerHTML = `
            <div class="sum-row">
              <div>
                <div class="sum-k">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</div>
                <div class="sum-v">${escapeHtml(payload.service_type || "â€”")}</div>
              </div>
              <div>
                <div class="sum-k">Ø§Ù„Ù…Ø¹Ø¯Ù„</div>
                <div class="sum-v">${avg.toFixed(1)}/5</div>
              </div>
            </div>
            ${notesSafe ? `<div class="sum-notes"><div class="sum-k">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div><div class="sum-v">${notesSafe}</div></div>` : ``}
          `;
        }

        jsonOut.textContent = JSON.stringify({ ...payload, sent_ok: !!sentOk }, null, 2);
        formCard.classList.add("hidden");
        doneCard.classList.remove("hidden");
      }

      function showForm() {
        doneCard.classList.add("hidden");
        formCard.classList.remove("hidden");
        form.reset();

        document.querySelectorAll("[data-live-for]").forEach((el) => (el.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"));
        if (doneSummary) doneSummary.innerHTML = "";

        lastPayload = null;
        jsonOut.textContent = "";

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù„Ø®Øµ
        setTimeout(() => {
          setServicePill();
          syncServiceUI();
          updateAverage();
          if (notesCount) notesCount.textContent = `0/${MAX_NOTES}`;
        }, 0);
      }

      wireLiveMeta();
      setServicePill();
      updateAverage();
      wireNotesCounter();
      document.getElementById("serviceType")?.addEventListener("change", setServicePill);

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (!validateService()) { if (serviceBtn) serviceBtn.focus(); return; }
        if (!form.checkValidity()) { form.reportValidity(); return; }

        submitBtn.disabled = true;
        submitBtn.textContent = "Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

        const payload = buildPayload();
        const sentOk = await sendPayload(payload);

        submitBtn.disabled = false;
        submitBtn.textContent = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†";

        showDone(payload, sentOk);
        toast(sentOk ? "ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…" : "ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…ØŒ Ù„ÙƒÙ† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙØ´Ù„" , !!sentOk);
      });


      form.addEventListener("reset", () => {
        setTimeout(() => {
          document.querySelectorAll("[data-live-for]").forEach((el) => (el.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"));
          setServicePill();
          syncServiceUI();
          updateAverage();
          if (notesCount) notesCount.textContent = `0/${MAX_NOTES}`;
        }, 0);
      });

      newOneBtn.addEventListener("click", showForm);

      copyBtn.addEventListener("click", async () => {
        if (!lastPayload) return;
        try {
          await navigator.clipboard.writeText(jsonOut.textContent);
          copyBtn.textContent = "ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…";
          toast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…", true);
          setTimeout(() => (copyBtn.textContent = "Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"), 1200);
        } catch {
          const ta = document.createElement("textarea");
          ta.value = jsonOut.textContent;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          copyBtn.textContent = "ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…";
          toast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…", true);
          setTimeout(() => (copyBtn.textContent = "Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"), 1200);
        }
      });
    })();
  </script>

  <script>
    /* ===== A11Y TOOLBAR JS ===== */
    (() => {
      const STORAGE_KEY = "a11y_settings_v1";

      const DEFAULT = {
        fontScale: 1,
        grayscale: false,
        highContrast: false,
        negativeContrast: false,
        lightBg: false,
        underlineLinks: false,
        readableFont: false
      };

      const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

      const btn = document.getElementById("a11yBtn");
      const panel = document.getElementById("a11yPanel");
      const scaleLabel = document.getElementById("a11yScaleLabel");

      if (!btn || !panel || !scaleLabel) return;

      function load() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return { ...DEFAULT };
          const parsed = JSON.parse(raw);
          return { ...DEFAULT, ...parsed };
        } catch {
          return { ...DEFAULT };
        }
      }

      function save(s) {
        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); } catch {}
      }

      function computeFilter(s) {
        const f = [];
        if (s.grayscale) f.push("grayscale(1)");
        if (s.negativeContrast) f.push("invert(1) hue-rotate(180deg)");
        return f.join(" ");
      }

      function apply(s) {
        document.documentElement.style.setProperty("--a11y-font-scale", String(s.fontScale));
        scaleLabel.textContent = `${Math.round(s.fontScale * 100)}%`;

        document.body.classList.toggle("a11y-light", !!s.lightBg);
        document.body.classList.toggle("a11y-contrast", !!s.highContrast);
        document.body.classList.toggle("a11y-underline", !!s.underlineLinks);
        document.body.classList.toggle("a11y-readable-font", !!s.readableFont);

        const filter = computeFilter(s);
        document.documentElement.style.filter = filter ? filter : "";

        document.querySelectorAll(".a11y-item[data-toggle]").forEach(el => {
          const key = el.getAttribute("data-toggle");
          el.classList.toggle("is-active", !!s[key]);
        });

        save(s);
      }

      function openPanel(open) {
        const isOpen = open ?? !panel.classList.contains("open");
        panel.classList.toggle("open", isOpen);
        btn.setAttribute("aria-expanded", String(isOpen));
        panel.setAttribute("aria-hidden", String(!isOpen));
      }

      let state = load();
      apply(state);

      btn.addEventListener("click", () => openPanel());

      document.addEventListener("click", (e) => {
        if (!panel.classList.contains("open")) return;
        const root = document.getElementById("a11y");
        if (root && !root.contains(e.target)) openPanel(false);
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") openPanel(false);
      });

      panel.addEventListener("click", (e) => {
        const b = e.target.closest(".a11y-item");
        if (!b) return;

        const action = b.getAttribute("data-action");
        const toggle = b.getAttribute("data-toggle");

        if (action === "text_inc") {
          state.fontScale = clamp(state.fontScale + 0.1, 0.85, 1.45);
          apply(state);
          return;
        }

        if (action === "text_dec") {
          state.fontScale = clamp(state.fontScale - 0.1, 0.85, 1.45);
          apply(state);
          return;
        }

        if (action === "reset") {
          state = { ...DEFAULT };
          apply(state);
          return;
        }

        if (toggle) {
          if (toggle === "highContrast") {
            state.highContrast = !state.highContrast;
            if (state.highContrast) state.negativeContrast = false;
          } else if (toggle === "negativeContrast") {
            state.negativeContrast = !state.negativeContrast;
            if (state.negativeContrast) state.highContrast = false;
          } else {
            state[toggle] = !state[toggle];
          }
          apply(state);
        }
      });
    })();
  </script>

</body>
</html>
